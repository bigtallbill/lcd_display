use flake

# Export additional environment variables for Elixir development
export ERL_AFLAGS="-kernel shell_history enabled"
export MIX_ENV=dev

# Set up local mix/hex directories to avoid global pollution
export MIX_HOME="$PWD/.nix-mix"
export HEX_HOME="$PWD/.nix-hex"

# Ensure directories exist
mkdir -p "$MIX_HOME" "$HEX_HOME"

# Install hex and rebar3 locally if not present
if ! command -v mix >/dev/null 2>&1; then
  echo "Mix not found, make sure to run 'nix develop' first"
else
  mix local.hex --force --if-missing >/dev/null 2>&1
  mix local.rebar3 --force --if-missing >/dev/null 2>&1
fi
